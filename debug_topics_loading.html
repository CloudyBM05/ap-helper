<!DOCTYPE html>
<html>
<head>
    <title>Debug Topics Loading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Debug Topics Loading Issue</h1>
    <div id="logs"></div>

    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            logsDiv.appendChild(logDiv);
            console.log(message);
        }

        async function debugTopicsLoading() {
            log('üîç Starting debug process...');
            
            // Test 1: Check if we can reach the backend
            log('üì° Testing backend connection...');
            try {
                const pingResponse = await fetch('http://127.0.0.1:8080/api/unit-topics?course=apush&unit=unit1');
                log(`‚úÖ Backend responds with status: ${pingResponse.status}`, 'success');
                
                if (!pingResponse.ok) {
                    log(`‚ùå Backend error: ${pingResponse.statusText}`, 'error');
                    return;
                }
                
                const pingData = await pingResponse.json();
                log(`‚úÖ Backend returns ${pingData.topics?.length || 0} topics for Unit 1`, 'success');
                
            } catch (error) {
                log(`‚ùå Cannot reach backend: ${error.message}`, 'error');
                return;
            }

            // Test 2: Test Unit 2 specifically 
            log('üìö Testing Unit 2 topics specifically...');
            try {
                const unit2Response = await fetch('http://127.0.0.1:8080/api/unit-topics?course=apush&unit=unit2');
                log(`‚úÖ Unit 2 API responds with status: ${unit2Response.status}`, 'success');
                
                if (!unit2Response.ok) {
                    log(`‚ùå Unit 2 API error: ${unit2Response.statusText}`, 'error');
                    return;
                }
                
                const unit2Data = await unit2Response.json();
                log(`‚úÖ Unit 2 has ${unit2Data.topics?.length || 0} topics`, 'success');
                
                if (unit2Data.topics && unit2Data.topics.length > 0) {
                    log(`üìù First topic: "${unit2Data.topics[0].title}"`, 'success');
                    log(`üìù Overview: "${unit2Data.overview.substring(0, 100)}..."`, 'success');
                } else {
                    log(`‚ùå No topics found in Unit 2 response`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Unit 2 API error: ${error.message}`, 'error');
            }

            // Test 3: Test CORS headers
            log('üîí Testing CORS headers...');
            try {
                const corsResponse = await fetch('http://127.0.0.1:8080/api/unit-topics?course=apush&unit=unit2', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const corsOrigin = corsResponse.headers.get('Access-Control-Allow-Origin');
                log(`üîí CORS Allow Origin: ${corsOrigin}`, corsOrigin ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå CORS test error: ${error.message}`, 'error');
            }

            log('‚úÖ Debug complete! Check the results above.');
        }

        // Start debug when page loads
        debugTopicsLoading();
    </script>
</body>
</html>
